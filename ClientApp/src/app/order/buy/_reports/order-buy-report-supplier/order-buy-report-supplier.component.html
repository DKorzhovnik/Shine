<main id="main" class="animated fadeInLeft">
  <!-- Year selection -->
  <mat-select
    placeholder="Choose a year"
    name="year"
    (selectionChange)="getData($event.value)"
  >
    <mat-option *ngFor="let year of years" [value]="year">
      {{ year }}
    </mat-option>
  </mat-select>

  <!-- Pivot table -->
  <div class="pivot-table">
    <table
      mat-table
      [dataSource]="dataSource"
      *ngIf="!showingChart; else chart"
    >
      <!-- SupplierName column -->
      <ng-container matColumnDef="supplierName">
        <th mat-header-cell *matHeaderCellDef>Supplier Name</th>
        <td mat-cell *matCellDef="let row">{{ row.supplierName }}</td>
        <td mat-footer-cell *matFooterCellDef>Total</td>
      </ng-container>

      <!-- Month columns -->
      <ng-container
        [matColumnDef]="column.key"
        *ngFor="let column of monthCols"
      >
        <th mat-header-cell *matHeaderCellDef>{{ column.value }}</th>
        <td mat-cell *matCellDef="let row">{{ row[column.key] | number }}</td>
        <td mat-footer-cell *matFooterCellDef>
          {{ getTotal(column.key) | number }}
        </td>
      </ng-container>

      <!-- Actions column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let row" class="actions">
          <mat-icon
            matTooltip="Show chart"
            color="primary"
            (click)="toggleChart(row)"
            >bar_chart</mat-icon
          >
        </td>
        <td mat-footer-cell *matFooterCellDef></td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: columnsToDisplay"></tr>
      <tr mat-footer-row *matFooterRowDef="columnsToDisplay; sticky: true"></tr>
    </table>
  </div>

  <ng-template #chart>
    <div class="animated fadeInLeft">
      <button mat-icon-button (click)="toggleChart()">
        <mat-icon>arrow_back</mat-icon>Go back
      </button>

      <app-order-buy-report-supplier-chart
        [chartData]="chartData"
      ></app-order-buy-report-supplier-chart>
    </div>
  </ng-template>
</main>
